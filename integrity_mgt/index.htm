
<!doctype html>
<html lang="en">
<!-- Hi Folks, this is the template file for pages in the citySchema.org documentation library -->
<head> <!-- Edit the following for each page -->
    <title>Managing CDASH Integrity</title>
    <meta name="description" content="A few workflows for reparing issues with CDASH Items." >
    <meta name="keywords" content="City Modeling, Digital Humanities, Geography">
    <meta name="author" content="Paul B. Cote">
    
<!-- don't edit between here and the Article div.  -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="icon" href="../resources/images/favicon.ico" type="image/x-icon">
    <script src="../resources/jquery/jquery-3.6.0.min.js"></script>
    <link href="../resources/docutree.css" rel="stylesheet"> 
    <script src="../resources/slideshow_pbc.js"></script>
    <link href="../resources/slideshow_pbc.css" rel="stylesheet"> 
    

    <!-- The index sidebar and all content other than the main article come from the cdash_includes.js.
          When you add a new page or internalachcor, you should update the index in cdash_includes.js.-->
    <script src="../resources/cdash_includes.js"></script>
    <!-- THis has to come after the cityschema_includes file-->
    <script src="../resources/docutree.js"></script>
    </head>
    <body>
      <div id="grid-container">
        <div id="index-container">
          <div id="index-header"> <!-- Content provided by cdash_includes.js--> </div>
          <div id="index">        <!-- Content provided by cdash_includes.js--> </div>
          <div id="index-footer"> <!-- Content provided by cdash_includes.js--> </div>
        </div> 
<div id="main-container">
  <div id="header"> <!-- Content provided by cdash_includes.js--> </div>

<!-- Page content goes inside the article div -->
  <div id="article">
  <h3 class="section_title"></h3>  <!-- Optional: would be the tile of the intro chapter.  -->
  <h1 class="title">Managing CDASH Relational Integrity</h1>
  <p>The relational organization of CDASH Folders, Place items and Document items mirros the organization of the physical Architectural Survey collection and the efficient update of the properties of document items that follow updates to their parent place items.  However, this extra layer of hierarchy goes beyond the ordinary structure of Omeka-S.  It is possible create issues with the relational integrity of the CDASH collections that will cause document items to become invisible and/or damaged.  
  
 <figure class="middle">
    <img src="images/admin_bar.jpg">
    <figcaption>The CDASH Admin Bar</figcaption>
  </figure>


  <p>The CDASH theme adds a couple of functions to the Admin Toolbar that shows up at the bottom of item show pages when an admin user is logged in.  The <b>GeoSync</b> function is the tool that automatically updates the Title, Streetsort and Marker location for related documents when one or more place items are updated. The <b>GeoAudit</b> function takes inventory of the collection and reports on integrity issues that can cause problems with establishing the relationship of documents to folders and places. 
  <h3>Integrity Issues flagged by the GeoAudit function</h3>
    <ul>
    <li><b>Folders that have duplicate names: </b> Folders are item Sets that are referenced by document and place items. These items refer to folders by name.  If there are folders with duplicate names, some items may fail to appear where we would expect them to.  
    <li><b>Document Items that reference zero or more than one Place item: </b> Since documents get their, titles, locations and streetsort keys from their parent Place items, if a document references more than one place, crucial properties of documents can become messed up -- which is can become hopelessly confusing.  It is very important to catch this problem immediately after the situation has arisen, otherwise, the resulting damage to the collection integrity can be very difficult to track down and fix.
    <li><b>Place Items that reference zero Document items: </b> While this is not necessarily an integrity issue, it usually indicates a situation where place items with duplicate names were created by different upload batches.  
    </ul>




    <div class="feature funfact">
    <h3>A Most Unfortunate Situation</h3>
    <p>One of the more harmful and difficult situations that can arise is if you assign one or more document items to the wrong place item.  The problem with this is that once you run the GeoSync process, the title and other properties of the affected documents will be updated to match the wrong place.  
    <p>
    This situation can be compared with placing documents in the wrong folder in the physical Architecture Survey.  But it is worse, since most of the document title is updated by the GeoSync function.  Once GeoSync is run, a situation of mis-field documents can become confusing to people who run-accross them.  But worse, than that, mis-filing documents will cause the affected items to become practically undiscoverable.
    <p>This is why, it is crucial that CDASH managers who are updating items check their work thoroughly and  keep a log of the corrections that they have made, so that steps can be re-traced.      
    </div>
      
    <div class="feature tour">
    <h3>The Document Accession Identifier Saves the Day</h3>
    <p>It is true that there are many ways that with Omeka's bulk editing tools combined with the GeoSync function can accidentally obliterate the actual identiy of many documents all at the same time and leaving little trace. When things like this happen, your bigest ace-in-the-hole is the CDASH Document Identifier property. Constructed during batch loading, the values for the Identifier property, e.g. <i>CDB240728F7D-24_Arrow_St-0048AM</i> can be parsed as 
      <ol>
        <li>CDB : CDASH Batch
        <li>Batch ID : YYMMDD
        <li>Folder ID : F[index]
        <li>Document ID
        <li>Document type
      </ol>
    <p>The CDASH Document Identifier property is very useful for tying a document to its original context in a upload batch which happened on a particular date drawing on sources from a particular folder of scans and to a physical folder in the file cabinets.  Therefore, this property is included often in queries that connect documents to Folders and to Places.
    <p>
     The Identifier property on CDASH Document and Place items, makes use of the Dublin Core Identifier term (which is good to know when trying to find it in the Omeka-S query builder interface.) 
     <p>
      There is never a reason to alter or clear the Identifier  

    </div>


<h2>Workflows for repairing common integrity issues</h2>
<p>At the time I am writing this the GeoAudit function is exposing many integrity problems that were created during the bulk upload process.  Most of these problems stem from the fact that the initial bulk loading process proceeded by batches of media folders which were digested to create Omeka Folders (item sets), Places and Documents, which were presumed to be unique.  As it happens, there are some folders and places whose names were repeated in subsequent batches.  When this happened, new folders and places were created, but the items that should have been assigned to the new folders and places were associated with the first Folder and Place that had been created using the duplicate name.  
<p>
Most of the time, the batches that tried to re-introduce duplicate places and folders are associated with different research districts. So the remedy will be to rename each of the twin folders -- by adding the name of the research district.  For example, we may have three folders named "Cambridge Street Views".  Each of these would get renamed to, for example, "Cambridge Street Views - East Cambridge".  The separator in this case is a single dash separated by spaces. <p>Duplicative place names are also re-named to by concatenating the research district as described above. 
<p>

   <div class="feature funfact">
    <h3>Nuts and Bolts of Cross-Referencing Place Items and Folders</h3>
  A couple of technical details that deserve mention here:  
  <ol>
    <li>In Omeka-S, each Item and Item Set has a unique Omeka Resource ID, which is the string of numerals that you see at the end of the URL for the item.
      This ID is actually a serial number which is managed by Omeka.  It is not editable and sticks with the item or item set for life. 
    <li>The Omeka Resource ID is the property that is used to link Document Items to Place Items and Place and Document items to Item Sets (CDASH Folders.)
    <li>In some of its interfaces, where a reference can be added to link a Document Item to a Place Item, or an Item to an Item Set. it appears as if you are using the Title of the Place Item or Item Set to make the reference.  This apparent use of the titles in these cases is supposed to make the editing interfaces more intuitive.  This can lead to momentary confusion when changing the Title of a Folder or the PlaceItem property of a Place Item does not interrupt the cross-referencing that connects document items to place items or folders. 
    <li>For a useful reference with all sorts of useful information concering the upload batches, see   The <a href="./images/cdash_import_ledger_251014.pdf" target="importledger">cdash_import_ledger.pdf</a> may also be useful for associating Documents, Folders and Places in CDASH with specific folders in the digital scan folders or the physical file drawers.  
  </ol>


   </div>



</p>
  <h3>Care and Preparation</h3>
  <p>Each of the workflows described here involves a similar set of steps:
    <ol>
      <li>Selection of a set of items (either Documents or Places, but rarely both)
      <li>Initiating a bulk edit for the selected records.
      <li>Clearing the values from one or more properties
      <li>Setting new values for the properties.
      <li>Checking the results
    </ol>
  <h2>Accidents Happen</h2> 
  <p>Adding and removing item values with Omeka-S exposes opportunities to make complicated mistakes.  We will illustrate several situations in the workflow descriptions.  But there are a few categories of screw-ups -- and remedies that are worth outlining in advance. 

  <h3>Recoverable and Unrecoverable and Invisible Situations</h3>
  <p>Most problems that arise from manipulating item values may be completely reversed with subsequent bulk edit. There are other problems that can only be recovered by restoring a point-in-time snapshot of the database taken at some point in the past 230 days.  The worst sort of mistake is one that nobody is aware of.  Many times repairing a problem can be very difficult if there is no recollection of the extent or the cause of the problem.  This to underscore the benefit of checking each step that you do and keeping a count of the numbers of records affected so that you can un-do mistakes easily, and be confident that your work is improving things. 
     
<h3>1. Start a ledger to record your update steps.</h3>
<p>In this ledger, it may be useful to record the names of the place documents and folders that have been split and the query expressions used to select the affected documents and the numbers of documents that were shifted from one or the other.  It is  very re-assuring at each step to look at the counts of items that are currently selected at each step.  This information will be helpful to have in front of you when you check the results of the changes.  The same information may be indispensable later if any of these changes ever come into question.  Here is a very verbose ledger demonstrating the de-consolidation of several folders Places and Documents.  <a href="./images/CDASH_Updates_Ledger.pdf" target="updates">CDASH_Updates_Ledger.pdf</a>.


<h3>2. Begin with a Duplicated Place</h3>
<p>It may be useful to begin the repair process by selecting a duplicated place from the GeoAudit output. By looking at the place on the map, you will probably find one or more other places nearby, or on the same street that share the same name.  From here, it may be clear that these places belong in different districts.  It may not matter, but for the sake of thoroughness, it may be better to select the place having the lowest Omeka Item ID (visible in the URL) and assign this to the research district that came earliest in the order of Box/Batches.  Then 
  <ol>
    <li>Look at the folders (Item Sets) involved.  When you find folders that geoAudit has identified as problematic, you can edit these first, distinguishing the folder names with the name or abbreviation of the research district.  use a single hyphen surrounded by spaces to append the District name to the folder name. Note that changing the names of folders does not alter the way that they inter-relate with items. 
    <li>While lookning at the folder item sets, click on the Items link on the right sidebar to get a sense of whether the folder has aything in it.  It is likely that some of them are empty and that subsequent fixes on duplicate place items will cause these folders to gain some contents. 
    </ol>
      
  <h3>3. Edit Duplicate Place Items</h3>
  <p>For place items that have accumulated document items associated with different research districts.
  <0l>
      <li>Update the Street Name property.  Use a hyphen between spaces to append the research district to the name to the Street Name property.  This change will propagate to the PlaceItem (Title) property of the Place and of any related documents, once you run the GeoSync button <b><i>But don't push it yet!</i></b>
    <li>Edit the marker location (Mapping Tab in the Item Edit interface.)  Remember that to register the change, you need to click Save on the left-side of the map and Save at the top right of the Mapping page.
    <li>Note that Omeka's Item ID for the places will stay the same.  This ID is what is used in the Document Item properties to reference the item's parent place item.
    <li>Where appropriate, change the Item Set association for the place to point to the correct folder.  Note that the changing the association with Item Sets is done through the Item Set tab at the top of the edit form.  The item property for Folders may be useful, but these deprecated properties don't actually do anything or appear anywhere. 
    <li>Press <b>Save</b> to save your changes.
    <li>Refresh your map window to confirm that your Place Item appears where it should and that its show page links the its folders as it should. 
    <li>Note the changes to this item and its omeka Item ID in your ledger. 
  </ol>

  <h3>Re-Assign Document Items to different Place Items and Folders</h3>
    4. Use Advanced Item Search and Bulk Edits to Re-Assign Documents to Places and Folders as Appropriate</h3>
  <p> One of your place items that you edited above will have accumulated the items that should have been assigned to the other formerly duplicate places.  Your task now is to 
    <ol>
      <li>Examine the properties, including the Research District and the Identifiers, of these document items to figure out how you are going to round them up with the advanced query tool.
      <li>You may find it useful to inspect the properties of an item with the View button on the Admin bar.  Note the Identifier button begins with the Batch and folder identifiers, which can be looked up in the <a href="./images/cdash_import_ledger_251014.pdf" target="importledger">cdash_import_ledger.pdf</a>
      <li>Start with an advanced item query to select all of the documents associated with the initial place, and make a not of the total number of items.  Note this in your ledger.
      <li>Now refine the query to narrow the selection to a set of <b>Bocument Items</b> associated with a batch which should be assigned to one of the empty Place Items that you edited, above.  
      <li><span style="color: red"><b>Important:</b></span> Make sure that your query selects Items by <b>Resource Template = CDASH Document</b> 
      <li>Note the number of documents affected.  Make sure that there aren;t place items mixed in. 
      <li>Lets tackle the folder assignment first. 
      <li>In the menu at the top left of the query return list, you have a pulldown that allows you to choose Batch Actions, choose <b>Edit</b>
      <li>Notice the number of items that is going to be affected. 
      <li>Use the <b>Add to Item Set</b> and <b>Remove from Item Set</b> functions to correct the folder situation.  Each document should be in one and only one folder. 
        
      </ol>


  


 

  </div> <!-- Closes #article div -->
  <div id="footer"> <!-- Content provided by cdash_includes.js--> </div> 




</div> <!-- Closes main container--> 
</div> <!-- closes grid container-->
</body>

</html>
    